<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="##5bbad5"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="##5bbad5"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#ffffff"/><title>มาลองเขียนแอปแอนดรอยด์เชื่อมต่อกับบลูทูธบน Arduino กัน</title><meta name="twitter:card" content="summary"/><meta property="og:title" content="มาลองเขียนแอปแอนดรอยด์เชื่อมต่อกับบลูทูธบน Arduino กัน"/><meta property="og:description" content="บล็อกสั้นวันนี้ขอเสนอการเขียนแอปแอนดรอยด์แบบง่ายๆ ด้วย Xamarin แต่จะว่าเขียนก็ไม่ถูกนะ เพราะก็อปเค้ามาแก้นิดเดียว แฮร่ แต่เนื่องจากโค้ดต้นฉบับเป็น open source ใต้ License Apache 2.0 แถมเราไม่ได้ทำเพื่อใช้แสวงหากำไรอีก ถือว่าเพื่อการศึกษาเนาะ"/><meta property="og:image" content="https://bluenex.dev/og-image.png"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:site_name" content="bluenex.dev"/><meta name="next-head-count" content="21"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-F093PPYMZP"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-F093PPYMZP', {
    page_path: window.location.pathname,
  });
</script><link rel="preload" href="/_next/static/css/8b94dfb47c3d0b0f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8b94dfb47c3d0b0f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-d7b038a63b619762.js" defer=""></script><script src="/_next/static/chunks/framework-1f10003e17636e37.js" defer=""></script><script src="/_next/static/chunks/main-3333d768940114e2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c01e99154c559c7c.js" defer=""></script><script src="/_next/static/chunks/61-d9b4cc2d9405e7c7.js" defer=""></script><script src="/_next/static/chunks/882-992cc3ca32858344.js" defer=""></script><script src="/_next/static/chunks/236-b0e06a4b1b884ca8.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bid%5D-be0ef0ed17253dc1.js" defer=""></script><script src="/_next/static/sJgMGggiFrjR84UHkDvGS/_buildManifest.js" defer=""></script><script src="/_next/static/sJgMGggiFrjR84UHkDvGS/_ssgManifest.js" defer=""></script><script src="/_next/static/sJgMGggiFrjR84UHkDvGS/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="min-w-screen debug-screens min-h-screen overflow-hidden bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-50 "><div class="flex min-h-screen flex-col justify-between gap-20"><div class="container mx-auto flex flex-col gap-6 px-6 pt-6 md:max-w-2xl md:px-0"><div class="relative flex items-center justify-between"><a class="flex items-center justify-center gap-4 hover:scale-105 hover:transition-transform hover:duration-300" href="/"><div class="overflow-hidden rounded-full border-2 border-sky-500 hover:scale-105 hover:transition-transform hover:duration-300 dark:border-sky-400 h-12 w-12"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;padding-top:100%"></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" sizes="100vw" srcSet="https://avatars.githubusercontent.com/u/11027706?v=4?imwidth=640 640w, https://avatars.githubusercontent.com/u/11027706?v=4?imwidth=750 750w, https://avatars.githubusercontent.com/u/11027706?v=4?imwidth=828 828w, https://avatars.githubusercontent.com/u/11027706?v=4?imwidth=1080 1080w, https://avatars.githubusercontent.com/u/11027706?v=4?imwidth=1200 1200w, https://avatars.githubusercontent.com/u/11027706?v=4?imwidth=1920 1920w, https://avatars.githubusercontent.com/u/11027706?v=4?imwidth=2048 2048w, https://avatars.githubusercontent.com/u/11027706?v=4?imwidth=3840 3840w" src="https://avatars.githubusercontent.com/u/11027706?v=4?imwidth=3840" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><span class="text-xl">bluenex</span></a><div class=""><button type="button" class="hover:scale-110 hover:duration-200"><svg viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 fill-gray-600 dark:hidden"><path d="M252,88a12.00028,12.00028,0,0,1-12,12H228v12a12,12,0,0,1-24,0V100H192a12,12,0,0,1,0-24h12V64a12,12,0,0,1,24,0V76h12A12.00028,12.00028,0,0,1,252,88ZM152,52h4v4a12,12,0,0,0,24,0V52h4a12,12,0,0,0,0-24h-4V24a12,12,0,0,0-24,0v4h-4a12,12,0,0,0,0,24Zm76.0459,96.85156a12.0055,12.0055,0,0,1,.13965,7.14356A104.01386,104.01386,0,1,1,99.9375,27.833a12.00423,12.00423,0,0,1,14.91992,14.918,80.03107,80.03107,0,0,0,98.32031,98.41113,12.00513,12.00513,0,0,1,14.86817,7.68945Zm-30.66309,19.00293A103.98165,103.98165,0,0,1,88.14551,58.61719a80.01075,80.01075,0,1,0,109.2373,109.2373Z"></path></svg><svg viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg" class="hidden h-7 w-7 fill-gray-50 dark:block"><path d="M128,56a72,72,0,1,0,72,72A72.0814,72.0814,0,0,0,128,56Zm0,120a48,48,0,1,1,48-48A48.05436,48.05436,0,0,1,128,176ZM116,28V20a12,12,0,0,1,24,0v8a12,12,0,0,1-24,0Zm74.22461,37.77417a11.99989,11.99989,0,0,1,.001-16.97046l5.65722-5.65674a11.99993,11.99993,0,1,1,16.96973,16.97119l-5.65723,5.65674a12,12,0,0,1-16.9707-.00073ZM248,128a12,12,0,0,1-12,12h-8a12,12,0,0,1,0-24h8A12,12,0,0,1,248,128Zm-35.147,67.88232A12.0001,12.0001,0,0,1,195.88232,212.853l-5.65722-5.65723a12.0001,12.0001,0,1,1,16.9707-16.9707ZM140,228v8a12,12,0,0,1-24,0v-8a12,12,0,0,1,24,0ZM65.7749,190.2251a12.00062,12.00062,0,0,1,0,16.9707L60.11768,212.853A12.0001,12.0001,0,0,1,43.147,195.88232l5.65723-5.65722A11.99973,11.99973,0,0,1,65.7749,190.2251ZM40,128a12,12,0,0,1-12,12H20a12,12,0,0,1,0-24h8A12,12,0,0,1,40,128Zm3.14746-67.88184A11.99993,11.99993,0,1,1,60.11719,43.147l5.65722,5.65674A11.99992,11.99992,0,1,1,48.80469,65.7749Z"></path></svg></button></div></div><nav class="mb-4 flex flex-col"><div class="flex justify-center gap-2"><a class="text-sky-500 underline underline-offset-2 hover:text-sky-700 dark:text-sky-400 hover:dark:text-sky-200" href="/blog/">blog</a><span>•</span><button class="text-sky-500 hover:text-sky-700 dark:text-sky-400 hover:dark:text-sky-200">tags</button><span>•</span><button class="text-sky-500 hover:text-sky-700 dark:text-sky-400 hover:dark:text-sky-200">years</button></div></nav><div class="mb-4 flex flex-col gap-4"><h1 class="text-center text-3xl font-semibold">มาลองเขียนแอปแอนดรอยด์เชื่อมต่อกับบลูทูธบน Arduino กัน</h1><div class="flex items-center justify-between gap-8"><div>tags:<!-- --> <!-- --><a class="text-sky-500 underline underline-offset-2 hover:text-sky-700 dark:text-sky-400 hover:dark:text-sky-200" href="/blog/?tag=android">android</a>, <!-- --><a class="text-sky-500 underline underline-offset-2 hover:text-sky-700 dark:text-sky-400 hover:dark:text-sky-200" href="/blog/?tag=arduino">arduino</a>, <!-- --><a class="text-sky-500 underline underline-offset-2 hover:text-sky-700 dark:text-sky-400 hover:dark:text-sky-200" href="/blog/?tag=diary">diary</a></div><div class="flex flex-col items-end"><span class="min-w-fit" title="Mon, 20 Mar 2017 13:17:00 GMT">20 มี.ค. 60</span></div></div></div><article class="
          prose
          prose-a:text-sky-500 prose-a:underline prose-a:underline-offset-2 hover:prose-a:text-sky-700
          prose-blockquote:border-sky-500 prose-blockquote:bg-sky-100 prose-blockquote:py-0.5 prose-blockquote:not-italic
          prose-pre:border-2 prose-pre:border-gray-500 prose-pre:p-0
          prose-li:leading-6
          prose-img:mx-auto
          dark:prose-invert
          prose-a:dark:text-sky-400 hover:prose-a:dark:text-sky-200
          prose-blockquote:dark:text-gray-800
        "><p>บล็อกสั้นวันนี้ขอเสนอการเขียนแอปแอนดรอยด์แบบง่ายๆ ด้วย Xamarin แต่จะว่าเขียนก็ไม่ถูกนะ เพราะก็อปเค้ามาแก้นิดเดียว แฮร่ แต่เนื่องจากโค้ดต้นฉบับเป็น open source ใต้ License Apache 2.0 แถมเราไม่ได้ทำเพื่อใช้แสวงหากำไรอีก ถือว่าเพื่อการศึกษาเนาะ</p>
<p>เริ่มกันเลย อุปกรณ์ที่เราใช้คือ Arduino Uno + HC-05 + Android 6.0 smart phone โดย HC-05 เป็น bluetooth module ที่เชื่อมต่อกับ Arduino Uno เนื่องจากบล็อกนี้จะบันทึกส่วนของแอปแอนดรอยด์เท่านั้น เพราะฉะนั้น รายละเอียดการต่อบอร์ดบลูทูธเข้ากับ Arduino เอย Arduino sketch เอย ให้ไปตามดูใน <a href="http://www.instructables.com/id/Arduino-AND-Bluetooth-HC-05-Connecting-easily/?ALLSTEPS">Instructables</a> ดังลิงค์ที่แปะไว้ให้นี้เนาะ</p>
<p>สมมติว่าต่อบอร์ดเสร็จ อัดโค้ดใส่ Arduino เสร็จ จับคู่ HC-05 กับมือถือของเราเสร็จ ขั้นตอนต่อไปเราก็จะมาเริ่มในส่วนของโค้ด Android กัน ในส่วนนี้เราจะใช้ Visual Studio + Xamarin ในการเขียน ซึ่งเราก็จะเขียนแอปง่ายๆ มีสองปุ่มคือเปิดกับปิด เพื่อเปิดและปิด LED ที่มีอยู่บนบอร์ด Arduino อยู่แล้ว อ้อลืมไป ไม่ใช่เขียนแต่เป็นดัดแปลง ถ้ามี Visual Studio แล้วก็ไปโคลน repo นี้มาเลย <a href="git@github.com:xamarin/monodroid-samples.git">xamarin/monodroid-samples</a> แล้วเข้าไปในโฟลเดอร์จะเห็น Bluetooth Chat ก็เข้าไปอีกครั้ง ที่นี้ก็จะมาเริ่มแก้กัน เริ่มจากเปลี่ยน Layout จาก <code>ListView</code> เป็น <code>LinearView</code> เสร็จแล้วก็ใส่ Header text ไปตามสะดวก เช่น <strong>LED SWITCH</strong> ก็ได้ จากนั้นก็ลากปุ่มมาสองปุ่ม ตั้งชื่อเป็นปุ่ม ON กับ OFF ใส่ string กับ id ให้เรียบร้อย จากนั้นก็ไปแก้โค้ดกัน</p>
<h2>BluetoothChat.cs</h2>
<p>ก่อนอื่นเพิ่ม <code>const</code> กันก่อนก่อนเข้า method <code>OnCreate()</code> ให้ใส่ led status เข้าไป</p>
<pre><code class="language-cs">// LED status
private const string LED_ON = "1";
private const string LED_OFF = "0";
</code></pre>
<p>ใน method <code>SetupChat()</code> ให้คอมเม้นต์ให้หมดเหลือไว้แค่ <code>chatService</code> กับ <code>outStringBuffer</code> จากนั้นก็หาน้องปุ่มด้วย <code>id</code> แล้วใส่ event click handler ไปตามนี้</p>
<pre><code class="language-cs">// Initialize the array adapter for the conversation thread
//conversationArrayAdapter = new ArrayAdapter&#x3C;string>(this, Resource.Layout.message);
//conversationView = FindViewById&#x3C;ListView>(Resource.Id.@in);
//conversationView.Adapter = conversationArrayAdapter;

// Initialize the compose field with a listener for the return key
//outEditText = FindViewById&#x3C;EditText>(Resource.Id.edit_text_out);
// The action listener for the EditText widget, to listen for the return key
//outEditText.EditorAction += delegate (object sender, TextView.EditorActionEventArgs e) {
//    // If the action is a key-up event on the return key, send the message
//    if (e.ActionId == ImeAction.ImeNull &#x26;&#x26; e.Event.Action == KeyEventActions.Up)
//    {
//        var message = new Java.Lang.String(((TextView)sender).Text);
//        SendMessage(message);
//    }
//};

//// Initialize the send button with a listener that for click events
//sendButton = FindViewById&#x3C;Button>(Resource.Id.button_send);
//sendButton.Click += delegate (object sender, EventArgs e) {
//    // Send a message using content of the edit text widget
//    var view = FindViewById&#x3C;TextView>(Resource.Id.edit_text_out);
//    var message = new Java.Lang.String(view.Text);
//    SendMessage(message);
//};

// On button
onButton = FindViewById&#x3C;Button>(Resource.Id.onButton);
onButton.Click += delegate (object sender, EventArgs e)
{
    SendMessage(new Java.Lang.String(LED_ON));
};

// Off button
offButton = FindViewById&#x3C;Button>(Resource.Id.offButton);
offButton.Click += delegate (object sender, EventArgs e)
{
    SendMessage(new Java.Lang.String(LED_OFF));
};

// Initialize the BluetoothChatService to perform bluetooth connections
chatService = new BluetoothService(this, new MyHandler(this));

// Initialize the buffer for outgoing messages
outStringBuffer = new StringBuffer("");
</code></pre>
<h2>BluetoothService.cs</h2>
<p>ไฟล์นี้แก้นิดเดียว โดยให้เปลี่ยน UUID ของที่เค้าให้มาเป็น UUID สำหรับอุปกรณ์ serial bluetooth ทั่วไป โค้ดข้างล่างคือคอมเม้นต์อันเก่าแล้วใส่อันใหม่ลงไป ส่วนที่มาของ UUID นี้ไปดูได้ที่ <a href="https://developer.android.com/reference/android/bluetooth/BluetoothDevice.html#createInsecureRfcommSocketToServiceRecord(java.util.UUID)">Android documentation</a></p>
<pre><code class="language-cs">//private static UUID MY_UUID = UUID.FromString ("fa87c0d0-afac-11de-8a39-0800200c9a66");
private static UUID MY_UUID = UUID.FromString("00001101-0000-1000-8000-00805F9B34FB");
</code></pre>
<p>เสร็จละ จากนั้นก็เสียบมือถือ debug ดู จะพบ error ขึ้นมาจำนวนหนึ่งเกิดจากการที่ตัวแปรบางตัวขาดๆ เกินๆ ก็ตาม debug ลบๆ คอมเม้นต์ๆ กันเอาตามสัญชาตญาณ</p>
<p>อนึ่ง บล็อกนี้ออกแนวจดไว้ดูเองจึงไม่เขียนละเอียด ใครผ่านมาอ่านทำตามไม่ได้ก็ต้องขออภัยมา ณ ที่นี้ด้วย หากมีข้อสงสัยเพิ่มเติมติดต่อได้ตามที่อยู่แถบล่างของบล็อกได้เลยฮะ</p>
</article><div class="mt-6 flex justify-between"><a class="text-sky-500 underline underline-offset-2 hover:text-sky-700 dark:text-sky-400 hover:dark:text-sky-200" href="/blog/">blog</a><button class="text-sky-500 hover:text-sky-700 dark:text-sky-400 hover:dark:text-sky-200">back to top</button></div></div><div class="bg-gray-200 py-5 dark:bg-gray-700"><div class="flex items-center justify-center gap-6"><a class="hover:scale-110 hover:duration-200" href="https://github.com/bluenex"><svg viewBox="0 0 24 24" role="img" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 fill-gray-600 dark:fill-gray-300"><title>GitHub icon</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="hover:scale-110 hover:duration-200" href="https://twitter.com/tulakann"><svg viewBox="0 0 24 24" role="img" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 fill-gray-600 dark:fill-gray-300"><title>Twitter icon</title><path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"></path></svg></a></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"2017-03-20-android-bt-serial","year":"2017","title":"มาลองเขียนแอปแอนดรอยด์เชื่อมต่อกับบลูทูธบน Arduino กัน","date":"20-03-2017 13:17","tags":["android","arduino","diary"],"excerpt":"บล็อกสั้นวันนี้ขอเสนอการเขียนแอปแอนดรอยด์แบบง่ายๆ ด้วย Xamarin แต่จะว่าเขียนก็ไม่ถูกนะ เพราะก็อปเค้ามาแก้นิดเดียว แฮร่ แต่เนื่องจากโค้ดต้นฉบับเป็น open source ใต้ License Apache 2.0 แถมเราไม่ได้ทำเพื่อใช้แสวงหากำไรอีก ถือว่าเพื่อการศึกษาเนาะ","contentHtml":"\u003cp\u003eบล็อกสั้นวันนี้ขอเสนอการเขียนแอปแอนดรอยด์แบบง่ายๆ ด้วย Xamarin แต่จะว่าเขียนก็ไม่ถูกนะ เพราะก็อปเค้ามาแก้นิดเดียว แฮร่ แต่เนื่องจากโค้ดต้นฉบับเป็น open source ใต้ License Apache 2.0 แถมเราไม่ได้ทำเพื่อใช้แสวงหากำไรอีก ถือว่าเพื่อการศึกษาเนาะ\u003c/p\u003e\n\u003cp\u003eเริ่มกันเลย อุปกรณ์ที่เราใช้คือ Arduino Uno + HC-05 + Android 6.0 smart phone โดย HC-05 เป็น bluetooth module ที่เชื่อมต่อกับ Arduino Uno เนื่องจากบล็อกนี้จะบันทึกส่วนของแอปแอนดรอยด์เท่านั้น เพราะฉะนั้น รายละเอียดการต่อบอร์ดบลูทูธเข้ากับ Arduino เอย Arduino sketch เอย ให้ไปตามดูใน \u003ca href=\"http://www.instructables.com/id/Arduino-AND-Bluetooth-HC-05-Connecting-easily/?ALLSTEPS\"\u003eInstructables\u003c/a\u003e ดังลิงค์ที่แปะไว้ให้นี้เนาะ\u003c/p\u003e\n\u003cp\u003eสมมติว่าต่อบอร์ดเสร็จ อัดโค้ดใส่ Arduino เสร็จ จับคู่ HC-05 กับมือถือของเราเสร็จ ขั้นตอนต่อไปเราก็จะมาเริ่มในส่วนของโค้ด Android กัน ในส่วนนี้เราจะใช้ Visual Studio + Xamarin ในการเขียน ซึ่งเราก็จะเขียนแอปง่ายๆ มีสองปุ่มคือเปิดกับปิด เพื่อเปิดและปิด LED ที่มีอยู่บนบอร์ด Arduino อยู่แล้ว อ้อลืมไป ไม่ใช่เขียนแต่เป็นดัดแปลง ถ้ามี Visual Studio แล้วก็ไปโคลน repo นี้มาเลย \u003ca href=\"git@github.com:xamarin/monodroid-samples.git\"\u003examarin/monodroid-samples\u003c/a\u003e แล้วเข้าไปในโฟลเดอร์จะเห็น Bluetooth Chat ก็เข้าไปอีกครั้ง ที่นี้ก็จะมาเริ่มแก้กัน เริ่มจากเปลี่ยน Layout จาก \u003ccode\u003eListView\u003c/code\u003e เป็น \u003ccode\u003eLinearView\u003c/code\u003e เสร็จแล้วก็ใส่ Header text ไปตามสะดวก เช่น \u003cstrong\u003eLED SWITCH\u003c/strong\u003e ก็ได้ จากนั้นก็ลากปุ่มมาสองปุ่ม ตั้งชื่อเป็นปุ่ม ON กับ OFF ใส่ string กับ id ให้เรียบร้อย จากนั้นก็ไปแก้โค้ดกัน\u003c/p\u003e\n\u003ch2\u003eBluetoothChat.cs\u003c/h2\u003e\n\u003cp\u003eก่อนอื่นเพิ่ม \u003ccode\u003econst\u003c/code\u003e กันก่อนก่อนเข้า method \u003ccode\u003eOnCreate()\u003c/code\u003e ให้ใส่ led status เข้าไป\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-cs\"\u003e// LED status\nprivate const string LED_ON = \"1\";\nprivate const string LED_OFF = \"0\";\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eใน method \u003ccode\u003eSetupChat()\u003c/code\u003e ให้คอมเม้นต์ให้หมดเหลือไว้แค่ \u003ccode\u003echatService\u003c/code\u003e กับ \u003ccode\u003eoutStringBuffer\u003c/code\u003e จากนั้นก็หาน้องปุ่มด้วย \u003ccode\u003eid\u003c/code\u003e แล้วใส่ event click handler ไปตามนี้\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-cs\"\u003e// Initialize the array adapter for the conversation thread\n//conversationArrayAdapter = new ArrayAdapter\u0026#x3C;string\u003e(this, Resource.Layout.message);\n//conversationView = FindViewById\u0026#x3C;ListView\u003e(Resource.Id.@in);\n//conversationView.Adapter = conversationArrayAdapter;\n\n// Initialize the compose field with a listener for the return key\n//outEditText = FindViewById\u0026#x3C;EditText\u003e(Resource.Id.edit_text_out);\n// The action listener for the EditText widget, to listen for the return key\n//outEditText.EditorAction += delegate (object sender, TextView.EditorActionEventArgs e) {\n//    // If the action is a key-up event on the return key, send the message\n//    if (e.ActionId == ImeAction.ImeNull \u0026#x26;\u0026#x26; e.Event.Action == KeyEventActions.Up)\n//    {\n//        var message = new Java.Lang.String(((TextView)sender).Text);\n//        SendMessage(message);\n//    }\n//};\n\n//// Initialize the send button with a listener that for click events\n//sendButton = FindViewById\u0026#x3C;Button\u003e(Resource.Id.button_send);\n//sendButton.Click += delegate (object sender, EventArgs e) {\n//    // Send a message using content of the edit text widget\n//    var view = FindViewById\u0026#x3C;TextView\u003e(Resource.Id.edit_text_out);\n//    var message = new Java.Lang.String(view.Text);\n//    SendMessage(message);\n//};\n\n// On button\nonButton = FindViewById\u0026#x3C;Button\u003e(Resource.Id.onButton);\nonButton.Click += delegate (object sender, EventArgs e)\n{\n    SendMessage(new Java.Lang.String(LED_ON));\n};\n\n// Off button\noffButton = FindViewById\u0026#x3C;Button\u003e(Resource.Id.offButton);\noffButton.Click += delegate (object sender, EventArgs e)\n{\n    SendMessage(new Java.Lang.String(LED_OFF));\n};\n\n// Initialize the BluetoothChatService to perform bluetooth connections\nchatService = new BluetoothService(this, new MyHandler(this));\n\n// Initialize the buffer for outgoing messages\noutStringBuffer = new StringBuffer(\"\");\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eBluetoothService.cs\u003c/h2\u003e\n\u003cp\u003eไฟล์นี้แก้นิดเดียว โดยให้เปลี่ยน UUID ของที่เค้าให้มาเป็น UUID สำหรับอุปกรณ์ serial bluetooth ทั่วไป โค้ดข้างล่างคือคอมเม้นต์อันเก่าแล้วใส่อันใหม่ลงไป ส่วนที่มาของ UUID นี้ไปดูได้ที่ \u003ca href=\"https://developer.android.com/reference/android/bluetooth/BluetoothDevice.html#createInsecureRfcommSocketToServiceRecord(java.util.UUID)\"\u003eAndroid documentation\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-cs\"\u003e//private static UUID MY_UUID = UUID.FromString (\"fa87c0d0-afac-11de-8a39-0800200c9a66\");\nprivate static UUID MY_UUID = UUID.FromString(\"00001101-0000-1000-8000-00805F9B34FB\");\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eเสร็จละ จากนั้นก็เสียบมือถือ debug ดู จะพบ error ขึ้นมาจำนวนหนึ่งเกิดจากการที่ตัวแปรบางตัวขาดๆ เกินๆ ก็ตาม debug ลบๆ คอมเม้นต์ๆ กันเอาตามสัญชาตญาณ\u003c/p\u003e\n\u003cp\u003eอนึ่ง บล็อกนี้ออกแนวจดไว้ดูเองจึงไม่เขียนละเอียด ใครผ่านมาอ่านทำตามไม่ได้ก็ต้องขออภัยมา ณ ที่นี้ด้วย หากมีข้อสงสัยเพิ่มเติมติดต่อได้ตามที่อยู่แถบล่างของบล็อกได้เลยฮะ\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"2017-03-20-android-bt-serial"},"buildId":"sJgMGggiFrjR84UHkDvGS","isFallback":false,"gsp":true,"scriptLoader":[]}</script><script defer="">(function initTheme() {
  if (
    localStorage.theme === "dark" ||
    (!("theme" in localStorage) &&
      window.matchMedia("(prefers-color-scheme: dark)").matches)
  ) {
    document.documentElement.classList.add("dark");
  }
})();</script></body></html>